<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/FavoritePost.css">
    <!-- <link rel="stylesheet" href="/assets/css/home.css"> -->


    <base href="/user/save-post">
</head>

<body ng-controller="FavoritesController">
    <h3 class="mb-3">Bãi đỗ đã lưu</h3>
    <!-- Shimmer Effect for Loading -->
    <div ng-show="loading" class="text-center">
        <div class="card mb-3 post-item">
            <div class="shimmer-wrapper" style="height: auto;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <div class="shimmer-block m-2" style="width: 100%; height: 250px; background: #e0e0e0;"></div>
                    </div>
                    <div class="col-md-8 d-flex flex-column">
                        <div class="card-title mb-0">
                            <div class="card-header bg-transparent border-0">
                                <div class="shimmer-block" style="height: 50px; background: #e0e0e0;"></div>
                            </div>
                            <div class="card-body flex-grow-1">
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 50%; height: 30px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-between mt-auto bg-transparent border-0">
                                <div class="shimmer-block" style="width: 100%; height: 50px; background: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3 post-item">
            <div class="shimmer-wrapper" style="height: auto;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <div class="shimmer-block m-2" style="width: 100%; height: 250px; background: #e0e0e0;"></div>
                    </div>
                    <div class="col-md-8 d-flex flex-column">
                        <div class="card-title mb-0">
                            <div class="card-header bg-transparent border-0">
                                <div class="shimmer-block" style="height: 50px; background: #e0e0e0;"></div>
                            </div>
                            <div class="card-body flex-grow-1">
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 50%; height: 30px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-between mt-auto bg-transparent border-0">
                                <div class="shimmer-block" style="width: 100%; height: 50px; background: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3 post-item">
            <div class="shimmer-wrapper" style="height: auto;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <div class="shimmer-block m-2" style="width: 100%; height: 250px; background: #e0e0e0;"></div>
                    </div>
                    <div class="col-md-8 d-flex flex-column">
                        <div class="card-title mb-0">
                            <div class="card-header bg-transparent border-0">
                                <div class="shimmer-block" style="height: 50px; background: #e0e0e0;"></div>
                            </div>
                            <div class="card-body flex-grow-1">
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 50%; height: 30px; background: #e0e0e0;">
                                </div>
                                <div class="shimmer-block mt-2" style="width: 90%; height: 20px; background: #e0e0e0;">
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-between mt-auto bg-transparent border-0">
                                <div class="shimmer-block" style="width: 100%; height: 50px; background: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="posts.length === 0 && !loading" class="text-center mt-3">
        <p>Bạn chưa lưu bài đăng nào.</p>
    </div>
    

    <!-- Listings -->
    <div class="card mb-3 post-item" ng-repeat="post in posts" ng-class="{'fade-in': !loading}">
        <a href="/post-detail?id={{post.idPost}}" style="text-decoration: none; color: inherit;">
            <div class="row g-0">

                <div class="col-md-4">

                    <div class="d-flex align-items-center justify-content-center"
                        style="height: 100%; background: #f8f9fa; position: relative;">

                        <img ng-src="{{post.images[0].imageUrl}}" loading="lazy" class="img-fluid rounded-start"
                            alt="Images" />
                    </div>
                </div>
                <div class="col-md-8 d-flex flex-column">
                    <div class="card h-100 d-flex flex-column">
                        <div class="card-header bg-transparent border-0">
                            <h4 class="font-weight-bold">{{post.parkingName}}</h4>

                        </div>
                        <div class="card-body flex-grow-1">
                            <h7 class="card-text district d-flex mb-2">
                                {{post.street}} {{post.wardName}}, {{post.districtName}},
                                {{post.provinceName}}
                            </h7>
                            <h4 class="card-text text-danger">
                                {{formatCurrency(post.price) + " " + post.priceUnit}}
                            </h4>
                            <span ng-repeat="vehicleType in post.vehicleTypes" class="vehicle-type-inline">
                                {{vehicleType.vehicleTypeName}}
                                <span ng-if="!$last"> - </span>
                            </span>
                        </div>
                        <div
                            class="card-footer bg-transparent d-flex justify-content-between align-items-center mt-auto">
                            <span class="promoted-label" ng-if="isPostPromoted(post.topPostEnd)">
                                Bài viết được quảng cáo
                            </span>
                            <p class="card-text username font-weight-bold mb-0">
                                Đăng bởi: {{post.user.firstName}} {{post.user.lastName}}
                                <small class="text-muted">{{formatTimeAgo(post.createdAt)}}</small>
                            </p>
                            <p class="card-text text-muted mb-0">
                                <i class="fa-regular fa-comment"></i> {{post.commentCount}}
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </a>
        <div class="d-flex justify-content-center mb-3 mt-3">
            <button class="btn btn-danger" ng-click="confirmUnfavorite(post)">
                <i class="fa fa-solid fa-bookmark"></i> Hủy lưu bài đăng
            </button>
        </div>    
    </div>


    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Xác nhận hủy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Bạn có chắc chắn muốn hủy lưu bài đăng này không?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-danger" ng-click="toggleFavorite()">Xác
                        nhận</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">

        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="https://res.cloudinary.com/dqzfuomvj/image/upload/v1730822083/1_au4rfg.jpg"
                    style="height:auto; width:50px" class="rounded me-2" alt="logo">
                <strong class="me-auto">Thông báo</strong>
                <!-- <small>11 mins ago</small> -->
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                {{ toastMessage }}
            </div>
        </div>
    </div>

    </div>
    <div ng-if="!isEmpty && !hasMoreData && posts.length > 0" class="text-center mt-3">
        Bạn đã đến cuối trang.
    </div>
</body>

</html>